<!DOCTYPE html>

<head>
    <title>{% block title %}Bitter{% endblock %}</title>

    <meta charset="utf-8">
    <meta lang="en">

    <link rel="shortcut icon", type="image/x-icon", href="{{ url_for('static', filename='img/favicon_48.png') }}">
    <link rel="stylesheet", type="text/css", href="{{ url_for('static', filename='styles/base.css') }}">
    {% block style %}{% endblock %}
    {% block script %}{% endblock %}
</head>

<body>
    <div id="post-popup" class="hidden">
        <div class="content">
            <h1>Create post</h1>
            <form id="post-creation-form" action="{{ url_for('create_post') }}" method="post" enctype="multipart/form-data">
                <textarea id="post-text-input" name="post-body" maxlength="{{ post_body_max_len }}" placeholder="Post body"></textarea>
                <label for="file"><br>Optionally upload an image (&lt;{{ post_max_image_size / (1024**2) }} MB)</label>
                <div class="image-upload">
                    <input type="file" name="image" accept="image/*" id="post-image-input">
                    <svg class="transparent-button"><use href="{{ url_for('static', filename='img/sprites.svg') }}#icon-x"></use></svg>
                </div>
                <input type="submit" value="Post" class="post-button"></input>
            </form>
            <script>document.getElementById("post-creation-form").reset()</script>
        </div>
        <svg class="transparent-button"><use href="{{ url_for('static', filename='img/sprites.svg') }}#icon-x"></use></svg>

        <script>
            let post_popup = document.getElementById("post-popup")
            post_popup.addEventListener("click", () => {post_popup.classList.toggle("hidden")})
            post_popup.querySelector(".content").addEventListener("click", (event) => {event.stopPropagation()})

            let image_upload_div = document.querySelector("#post-popup .content #post-creation-form .image-upload")
            image_upload_div.lastElementChild.addEventListener("click", () => {
                image_upload_div.firstElementChild.value = null
            })
        </script>
    </div>

    <div id="sidebar">
        <a class="item transparent-button top-icon" href="{{ url_for('timeline') }}"><img class="icon" src="{{ url_for('static', filename='img/favicon_128.png') }}" alt="Website icon"></use></svg></a>
        <a class="item transparent-button{{' active-item' if page_name == 'Timeline' else ''}}" href="{{ url_for('timeline') }}"><svg class="icon"><use href="{{ url_for('static', filename='img/sprites.svg') }}#icon-views"></use></svg>Home</a>
        <a class="item transparent-button{{' active-item' if page_name in ['Chat', 'Conversations'] else ''}}" href="{{ url_for('chat') }}"><svg class="icon"><use href="{{ url_for('static', filename='img/sprites.svg') }}#icon-chat"></use></svg>Chat</a>
        <a class="item transparent-button{{' active-item' if page_name == 'Profile' else ''}}" href="{{ url_for('profile') }}"><svg class="icon"><use href="{{ url_for('static', filename='img/sprites.svg') }}#icon-profile"></use></svg>Profile</a>
        <div class="item post-button" onclick="document.getElementById('post-creation-form').reset() ; document.getElementById('post-popup').classList.toggle('hidden')">Post</div>
    </div>
    <div id="content">
        <div id="content-header" class="{{ 'back-button-disabled' if primary_page else '' }}">
            {% if not primary_page %}
            <a class="back-button" href="{{ referer if referer else url_for('timeline') }}" title="Back"><svg class="icon transparent-button"><use href="{{ url_for('static', filename='img/sprites.svg') }}#icon-back"></use></svg></a>
            {% endif %}
            {{ page_name }}
        </div>
        {% block content %}
        {% endblock %}
    </div>

</body>

<script>
    let sidebar = document.getElementById("sidebar")
    let content = document.getElementById("content")

    function apply_layout() {
        let aspect_ratio = window.innerWidth / window.innerHeight
        if (aspect_ratio < 0.75 || window.innerWidth < 600) {
            sidebar.classList.add("layout-small")
            content.classList.add("layout-small")
        } else {
            sidebar.classList.remove("layout-small")
            content.classList.remove("layout-small")
        }
    }

    apply_layout()
    window.addEventListener("resize", apply_layout)
</script>
